#!/bin/sh
#/ usage: toggle-drive [drive [...]]
#/ Toggle a "drive" under /srv/node* between being "mounted" or not.

[ -z "$1" -o "$1" = "-h" -o "$1" = "--help" ] && {
    grep '^#/' "$0" | cut -c4-
    exit 2
}

set +e
for drive in "$@"; do
    case "$drive" in
        /srv/node*)
            if [ -L "$drive" ]; then
                rm "$drive"
                mkdir -m 0500 "$drive"
                echo "$drive now unmounted"
            elif [ -d "$drive" ]; then
                rmdir "$drive"
                ln -s /mnt/swift-disk/"$(basename "$drive")" "$drive"
                echo "$drive now mounted"
            else
                echo "Expected '$drive' to be a link or directory; ignoring"
            fi
            ;;
        *)
            echo "Expected '$drive' to start with '/srv/node'; ignoring"
            ;;
    esac
done
